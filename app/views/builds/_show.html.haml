- provide :title, " | #{ @build.number } (#{ @build.tag })"

%table
  %tr
    %td
      %strong
        = @build.number + ' (' + @build.tag + ')'
    %td
      %table{ style: "table-layout: fixed;", border: 1 , bordercolor: 'grey' }
        %tr
          %td{ bgcolor: '#67E46F', width: "25px", align: "center", title: "Verified" }
            = @bugs.find_all{ |bug| bug[:status] == 'VERIFIED' && bug[:included] }.length
          %td{ bgcolor: '#6C8CD5', width: "25px", align: "center", align: "center", title: "To-verify" }
            = @bugs.find_all{ |bug| bug[:status] == 'TO-VERIFY' && bug[:included] }.length
          %td{ bgcolor: '#FF7373', width: "25px", align: "center", align: "center", title: "Reopened" }
            = @bugs.find_all{ |bug| bug[:status] == 'REOPENED' && bug[:included] }.length
          %td{ bgcolor: '#848181', width: "25px", align: "center", align: "center", title: "Closed" }
            = @bugs.find_all{ |bug| bug[:status] == 'CLOSED' && bug[:included] }.length
          %td{ width: "25px", align: "center", align: "center", title: "Not processed" }
            = @bugs.find_all{ |bug| bug[:status] == 'RESOLVED' && bug[:included] }.length
          %td{ width: "60px", align: "center", align: "center", title: "Hidden (last commit doesn't included)" }
            %font{ color: "grey" }
              = @bugs.find_all{ |bug| !bug[:included] }.length
            - if @bugs.find_all{ |bug| !bug[:included] }.length > 0
              = link_to "show", "javascript:;", id: "toggle_not_included"
          %td{ width: "80px", align: "center" }
            Total:
            = @bugs.length
    %td
      = link_to image_tag("refresh.png"), @build, remote: true, title: "Refresh"

.bug-list{ style: "width: 99%; height: 680px; overflow: auto" }
  - if !@bugs.empty?
    %table.table.table-bordered.bugs-table
      %tr
        %th{ bgcolor: "white" }
          Bug id
        %th
          Summary
        %th
          Status
        %th
          Verificators
      - @bugs.each do |bug|
        - html_class = " not-included"
        - html_color = "grey"
        - html_title = "Last commit in this bug made AFTER build release"
        - html_title = html_color = html_class = "" if bug[:included]
        %tr.bug-row{ bgcolor: { 'VERIFIED' => '#67E46F', 'TO-VERIFY' => '#6C8CD5', 'REOPENED' => '#FF7373', 'CLOSED' => '#848181' }[bug[:status]], class: "collapse in " + bug[:status].downcase + html_class, title: html_title }
          %td{ style: "vertical-align: middle; width: 65px", bgcolor: "white" }
            .bug-link-container
              %font{ color: html_color }
                = link_to bug[:id], Settings.bugzilla_url + '/show_bug.cgi?id=' + bug[:id].to_s, target: '_blank'
          %td{ style: "vertical-align:middle;" }
            %font{ color: html_color }
              = bug[:summary]
          %td{ style: "vertical-align: middle; width: 95px; align: center" }
            %font{ color: html_color }
              %strong= bug[:status]
          %td{ style: "vertical-align: middle; width: 350px" }
            %font{ color: html_color }
              - if !bug[:assignments].empty?
                %table
                  - bug[:assignments].each do |assignment|
                    %tr
                      %td= assignment[:tester] + ' (' + assignment[:assignment] + ')'
  - else
    No bug found

